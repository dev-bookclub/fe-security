# 인증과 인가: 로그인 정보 보호와 스토리지 사용 시 주의사항

웹 애플리케이션에서 인증(Authentication)과 인가(Authorization)는 사용자의 신원을 확인하고, 해당 사용자가 어떤 리소스에 접근할 수 있는지를 결정하는 중요한 보안 단계입니다. 이 과정에서 사용자 정보를 안전하게 다루기 위해서는 다양한 브라우저 저장 방식과 그에 따른 보안 설정을 정확히 이해하고 활용해야 합니다.

---

## 1. 로그인 정보 유출에 주의하기

### 1.1 HTTPS를 통해 안전한 통신 보장

- 로그인 정보(세션 쿠키 등)는 반드시 HTTPS를 통해 암호화된 채널에서 전송되어야 하며, TLS를 강제하는 방식으로 설정해야 합니다.
- HTTP로 접속했을 경우 HTTPS로 리디렉션하거나 접근 자체를 차단하는 보안 설정이 필요합니다.

### 1.2 Secure 속성

- `Secure` 속성이 설정된 쿠키는 HTTPS 연결이 아닌 경우 브라우저가 서버에 전송하지 않습니다.

```http
Set-Cookie: sessionid=abc123; Secure
```

### 1.3 HttpOnly 속성

- `HttpOnly` 속성을 통해 JavaScript에서 쿠키에 접근하는 것을 차단할 수 있으며, XSS로 인한 쿠키 탈취를 방지합니다.

```http
Set-Cookie: sessionid=abc123; HttpOnly
```

---

## 2. 브라우저의 저장소 사용 시 보안 고려사항

웹 애플리케이션은 로그인 정보 또는 토큰을 저장하기 위해 쿠키 외에도 `localStorage`, `sessionStorage`, `IndexedDB` 등을 사용할 수 있습니다. 그러나 각각 보안 특성이 다르므로 주의가 필요합니다.

### 2.1 localStorage / sessionStorage 사용 시 주의점

| 항목      | 설명                                                                          |
| --------- | ----------------------------------------------------------------------------- |
| 접근 방식 | JavaScript를 통해 직접 접근 가능                                              |
| 지속성    | localStorage는 브라우저 종료 후에도 유지, sessionStorage는 탭이 닫히면 제거됨 |
| 보안 위험 | XSS 공격에 취약하여 토큰이 탈취될 수 있음                                     |
| 사용 제한 | 민감한 정보(액세스 토큰 등)는 가급적 저장하지 않는 것이 권장됨                |

**예시 (취약):**

```js
// XSS에 의해 탈취될 수 있음
localStorage.setItem('access_token', token);
```

### 2.2 안전하게 스토리지 사용하기

- 민감한 정보는 가급적 브라우저 저장소가 아닌 쿠키(HttpOnly + Secure)로 저장
- 꼭 localStorage를 사용해야 하는 경우, XSS 방지를 위해 콘텐츠 보안 정책(CSP)을 강력히 적용

### 2.3 세션 쿠키 기반 인증

- 로그인 세션은 서버 측 세션과 연동되는 쿠키에 저장하고, 이 쿠키에 `Secure`, `HttpOnly`, `SameSite` 설정을 함께 적용하여 보안을 강화할 수 있습니다.

```http
Set-Cookie: sessionid=xyz789; Secure; HttpOnly; SameSite=Strict
```

---

## 3. 정리

| 저장 방식         | XSS에 안전한가? | 지속성                    | 서버 자동 전송 여부 | 추천 용도          |
| ----------------- | --------------- | ------------------------- | ------------------- | ------------------ |
| `HttpOnly Cookie` | ✅              | 브라우저 설정에 따라      | ✅                  | 로그인 세션 유지   |
| `localStorage`    | ❌              | 브라우저 종료 후에도 유지 | ❌                  | 비민감한 UI 설정   |
| `sessionStorage`  | ❌              | 탭이 닫히면 삭제          | ❌                  | 비민감한 단기 정보 |

---

## 4. 권장 보안 조치 요약

- **세션 관리**: `Secure`, `HttpOnly`, `SameSite` 속성을 갖는 쿠키를 기본값으로 설정
- **스토리지 사용 제한**: localStorage는 가급적 사용하지 않으며, 사용할 경우 CSP 및 XSS 필터 적용
- **HTTPS 강제**: 인증 과정 및 API 요청은 반드시 HTTPS로 제한
- **XSS 대응**: 모든 사용자 입력값에 대해 escaping 및 sanitization 적용
